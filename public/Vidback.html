<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vidback</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

    <script src="/js/jquery-3.2.1.min.js"></script>
</head>
<body>
    <div class="search-container" >
      <div class="search-bar">
        <input type="text" id="search" placeholder="# Hashtag">
        <span class="input-group-btn">
            <button class="btn" id="search-btn" type="button">Search</button>
        </span>
      </div>
      <hr/>
      <div class="introduction">
        <p>This is for </p>
      </div>
    </div>
    <div id="container"></div>


<script type="text/javascript" src="/js/globe.js"></script>
<script src="/js/three.min.js"></script>
<script src="https://unpkg.com/draggabilly@2/dist/draggabilly.pkgd.min.js"></script>
<script>
    function detectWebGLContext () {
        // Create canvas element. The canvas is not added to the
        // document itself, so it is never displayed in the
        // browser window.
        var canvas = document.createElement("canvas");
        // Get WebGLRenderingContext from canvas element.
        var gl = canvas.getContext("webgl")
            || canvas.getContext("experimental-webgl");
        // Report the result.
        if (gl && gl instanceof WebGLRenderingContext) {
            return true;
        } else {
            return false;
        }
    }
    /*
    Check the compatibility of webgl
     */
    if (detectWebGLContext()) {

      var container = document.getElementById('container');
      var globe = new DAT.Globe(container);
      globe.animate();


       xhr = new XMLHttpRequest();
       xhr.open('GET', '/js/data.json', true);
       xhr.onreadystatechange = function(e) {
           if (xhr.readyState === 4) {
               if (xhr.status === 200) {
                   var data = JSON.parse(xhr.responseText);
                   window.data = data;
                   for ( var i = 0; i < data.length; i ++ ) {
                      globe.addData( data[i][1], {format: 'magnitude', name: data[i][0]} );
                    }
                   globe.createPoints();
                   globe.animate();
               }
           }
       };
       xhr.send(null);

       $("#search-btn").click(function(){
         $.ajax({
           method: "POST",
           url: "/api/search",
           dataType: "json",
           data: {q: $("#search").val()},
           success: function(data){
             console.log(data);
           },
           error: function(){
             alert("Lost the connection to the server");
           }
           
         });
       });

    } else {
        alert("WebGL isn't supported in this browser");
        window.close();
    }
</script>

</body>
</html>
